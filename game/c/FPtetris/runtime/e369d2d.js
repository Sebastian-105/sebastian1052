(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"1xzG":function(t,i,e){t.exports=e.p+"assets/3GnztUP.mp3"},"72YK":function(t,i,e){t.exports=e.p+"assets/bvvT9l7.mp3"},Bvue:function(t,i,e){t.exports=e.p+"assets/IkaigrC.mp3"},Rf4s:function(t,i,e){"use strict";e.r(i);var s,o,n=e("IqKQ"),r=function(){function t(t){this.sceneStack=[],this.currentScene=null,this.isDirty=!1,this.app=t}return t.prototype.update=function(t){var i=this;return this.sceneStack[0]!==this.currentScene&&(this.currentScene&&this.currentScene.onLeave(),this.currentScene=this.sceneStack[0],this.currentScene.onEnter(this.popUserdata),this.popUserdata=void 0),this.isDirty=!1,(!this.currentScene.isInputEnabled()||(this.currentScene.onProcessInput(this.app.input,t),!this.isDirty))&&(this.sceneStack.some(function(e){return!0!==e.onUpdate(t)||i.isDirty}),!this.isDirty)},t.prototype.clear=function(){return this.currentScene&&(this.currentScene.onLeave(),this.currentScene=null),this.sceneStack.forEach(function(t){t.onDestroy()}),this.sceneStack=[],this.isDirty=!0,this},t.prototype.push=function(t){return this.sceneStack.unshift(t),this.isDirty=!0,t._resize(),this},t.prototype.switchTo=function(t){return this.clear().push(t)},t.prototype.pop=function(t){return 0===this.sceneStack.length?this:(this.popUserdata=t,this.currentScene==this.sceneStack[0]&&(this.currentScene.onLeave(),this.currentScene=null),this.sceneStack[0].onDestroy(),this.sceneStack.shift(),this)},t.prototype.updateScreenSize=function(t,i){return this.sceneStack.forEach(function(e){e.onResize(t,i)}),this},t}(),a=e("mrSG"),h=e("m4NB"),p=function(){function t(t){this.stage=new n.b,this.app=t,this.manager=t.sceneManager,t.stage.addChild(this.stage)}return t.prototype.onEnter=function(t){this._setStageVisible(!0)},t.prototype.onLeave=function(){this._setStageVisible(!1)},t.prototype.onDestroy=function(){this.app.stage.removeChild(this.stage)},t.prototype.onResize=function(t,i){},t.prototype.onUpdate=function(t){},t.prototype.onProcessInput=function(t,i){},t.prototype.isInputEnabled=function(){return!0},t.prototype._setStageVisible=function(t){this.stage.visible=t},t.prototype._resize=function(){var t=this.app.getSize(),i=t.width,e=t.height;this.onResize(i,e)},t}(),c=function(t){function i(i,e){var s=t.call(this)||this;return s.graphics=new n.c,s.texture=i,s.setSubRect(e),s.addChild(s.graphics),s}return a.b(i,t),i.prototype.setSubRect=function(t){if(void 0===t){var i=this.texture,e=i.width,s=i.height;this.subRect=new n.f(0,0,e,s)}else this.subRect=t;this.update()},i.prototype.setHitArea=function(t){this.hitAreaOverride=t,this.hitArea=void 0===t?this.subRect:t},i.prototype.setSize=function(t,i){this.scale.x=t/this.subRect.width,this.scale.y=i/this.subRect.height},i.prototype.update=function(){var t=this.graphics;t.clear(),t.beginTextureFill(this.texture);var i=this.subRect,e=i.x,s=i.y,o=i.width,n=i.height;t.drawRect(e,s,o,n),t.pivot.x=e,t.pivot.y=s,this.updateHitArea()},i.prototype.updateHitArea=function(){if(this.hitAreaOverride)this.hitArea=this.hitAreaOverride;else{var t=this.subRect,i=t.width,e=t.height;this.hitArea=new n.f(0,0,i,e)}},i}(n.b),u=16;!function(t){t[t.Block1=0]="Block1",t[t.Block2=1]="Block2"}(o||(o={}));var d,l=((s={})[o.Block1]=new n.f(9,225,8,8),s[o.Block2]=new n.f(0,225,8,8),s),_=function(t){function i(i,e){var s=t.call(this)||this,o=new n.c;o.beginFill(i),o.drawRect(0,0,u,u),s.addChild(o);var r=l[e],a=new c(h.a.stage.texture,r);return a.scale.x=2,a.scale.y=2,s.addChild(a),s}return a.b(i,t),i}(n.b),f=u+0,m=10,v=20,y=function(t){function i(){var i=t.call(this)||this;return i._panic=!1,i._data=new Array(v).fill([]).map(function(){return new Array(m).fill(0)}),i}return a.b(i,t),i.prototype.setColors=function(t,i,e){void 0===e&&(e=!0),this._colors=[t,i],e&&this.update()},i.prototype.update=function(){var t=this;this.removeChildren(),this._panic=!1,this._data.forEach(function(i,e){i.forEach(function(i,s){if(0!==i){e<5&&(t._panic=!0);var n=t._colors[(i-1)%2],r=1==i?o.Block1:o.Block2,a=new _(n,r);a.position.x=s*f,a.position.y=e*f,t.addChild(a)}})})},i.prototype.collidesWith=function(t,i,e,s){var o=this;return t.getShape(s).some(function(t,s){return t.some(function(t,n){if(0===t)return!1;var r=i+n;if(r<0||r>=m)return!0;var a=e+s;return!(a<0)&&(a>=v||0!==o._data[a][r])})})},i.prototype.unite=function(t,i,e){var s=this,o=t.getShape(),n=t.getColorIndex(),r=[];return o.forEach(function(t,o){var a=e+o;if(!(a<0)){var h=!1;t.forEach(function(t,e){if(0!==t){h=!0;var o=i+e;s._data[a][o]=n+1}}),h&&!s._data[a].some(function(t){return 0===t})&&(r.push({row:a,blocks:s._data[a]}),s._data[a]=new Array(m).fill(0))}}),r},i.prototype.removeRow=function(t){for(var i=t-1;i>=0;--i)this._data[i+1]=this._data[i];this._data[0]=new Array(m).fill(0)},i.prototype.shouldPanic=function(){return this._panic},i}(n.b);!function(t){t[t.Deg0=0]="Deg0",t[t.Deg90=1]="Deg90",t[t.Deg180=2]="Deg180",t[t.Deg270=3]="Deg270"}(d||(d={}));var g,w={T:{name:"T",color:0,size:3,offset:1,center:[[1.5,2],[1,1.5],[1.5,1],[2,1.5]],shapes:[[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]],[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]]]},J:{name:"J",color:1,size:3,offset:1,center:[[1.5,2],[1,1.5],[1.5,1],[2,1.5]],shapes:[[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]],[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]]]},Z:{name:"Z",color:2,size:3,offset:1,center:[[1.5,2],[2,1.5]],shapes:[[[0,0,0],[1,1,0],[0,1,1]],[[0,0,1],[0,1,1],[0,1,0]]]},O:{name:"O",color:0,size:2,offset:0,center:[[1,1]],shapes:[[[1,1],[1,1]]]},S:{name:"S",color:1,size:3,offset:1,center:[[1.5,2],[2,1.5]],shapes:[[[0,0,0],[0,1,1],[1,1,0]],[[0,1,0],[0,1,1],[0,0,1]]]},L:{name:"L",color:2,size:3,offset:1,center:[[1.5,2],[1,1.5],[1.5,1],[2,1.5]],shapes:[[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]],[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]]]},I:{name:"I",color:0,size:4,offset:2,center:[[2,2.5],[2.5,2]],shapes:[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]]}},S=function(t){function i(i){var e=t.call(this)||this;e._angle=d.Deg0,e._type="string"==typeof i?w[i]:i;var s=e.getCenter(),o=s[0],n=s[1];return e.pivot.x=f*o,e.pivot.y=f*n,e}return a.b(i,t),i.getRandom=function(){var t=["I","O","T","J","L","S","Z"];return new i(t[Math.floor(Math.random()*t.length)])},i.prototype.setColors=function(t,i,e){void 0===e&&(e=!0),this._colors=[t,i],e&&this.update()},i.prototype.update=function(){var t=this;this.removeChildren();var i=this.getShape(),e=this._type.color,s=this._colors[e%2],n=0==e?o.Block1:o.Block2;i.forEach(function(i,e){i.forEach(function(i,o){if(0!==i){var r=new _(s,n);r.position.x=o*f,r.position.y=e*f,t.addChild(r)}})})},i.prototype.getSize=function(){return this._type.size},i.prototype.getShape=function(t){void 0===t&&(t=this._angle);var i=this._type.shapes;return i[t%i.length]},i.prototype.getColorIndex=function(){return this._type.color},i.prototype.getAngle=function(){return this._angle},i.prototype.setAngle=function(t){this._angle=t;var i=this.getCenter(),e=i[0],s=i[1];this.pivot.x=f*e,this.pivot.y=f*s},i.prototype.getOffset=function(){return this._type.offset},i.prototype.getCenter=function(t){void 0===t&&(t=this._angle);var i=this._type,e=i.shapes;return i.center[t%e.length]},i.prototype.getName=function(){return this._type.name},i.prototype.setX=function(t){this.position.x=t+this.pivot.x},i.prototype.setY=function(t){this.position.y=t+this.pivot.y},i}(n.b),x=[40,100,300,1200],b=[[22776,3980540],[43008,12122136],[14155980,16283896],[22776,5822548],[14942296,5830808],[5830808,6850812],[16267264,8158332],[6833404,11010080],[22776,16267264],[16267264,16556100]],C=[.799,.715,.632,.549,.466,.383,.3,.216,.133,.1,.083,.083,.083,.067,.067,.067,.05,.05,.05,.033,.033,.033,.033,.033,.033,.033,.033,.033,.033,.017];!function(t){t[t.Full=0]="Full",t[t.Positive=1]="Positive",t[t.Negative=2]="Negative",t[t.Hat=3]="Hat"}(g||(g={}));var T,R,D=1,M=.35;function A(t,i){var e;return{keys:i?{ArrowUp:T.Up,ArrowLeft:T.Left,ArrowDown:T.Down,ArrowRight:T.Right,Space:T.Rotate,Enter:T.Drop,Escape:T.Pause}:{38:T.Up,37:T.Left,40:T.Down,39:T.Right,32:T.Rotate,13:T.Drop,27:T.Pause},keyAxes:(e={},e[T.Up]={axis:R.LeftY,factor:-1,opposite:T.Down},e[T.Down]={axis:R.LeftY,factor:1,opposite:T.Up},e[T.Left]={axis:R.LeftX,factor:-1,opposite:T.Right},e[T.Right]={axis:R.LeftX,factor:1,opposite:T.Left},e)}}!function(t){t[t.Up=1]="Up",t[t.Left=2]="Left",t[t.Down=4]="Down",t[t.Right=8]="Right",t[t.Rotate=16]="Rotate",t[t.Drop=32]="Drop",t[t.Pause=64]="Pause"}(T||(T={})),function(t){t[t.LeftX=0]="LeftX",t[t.LeftY=1]="LeftY",t[t.RightX=2]="RightX",t[t.RightY=3]="RightY",t[t.DpadX=4]="DpadX",t[t.DpadY=5]="DpadY",t[t.TriggerL=6]="TriggerL",t[t.TriggerR=7]="TriggerR"}(R||(R={}));var k,O=192,L=80;!function(t){t[t.Paused=0]="Paused",t[t.Idle=1]="Idle",t[t.RotationAnimation=2]="RotationAnimation",t[t.RowAnimation=3]="RowAnimation",t[t.DropAnimation=4]="DropAnimation",t[t.GameOver=5]="GameOver",t[t.AdjustingCamera=6]="AdjustingCamera"}(k||(k={}));var P=function(t){function i(i,e){var s,o;void 0===e&&(e={});var r=t.call(this,i)||this;r._grid=new y,r._state=k.Idle,r._stepTime=0,r._stepDuration=.799,r._animationTime=0,r._animateRotation=!0,r._rotationDuration=.15,r._completeRows=[],r._completeRowsBlocks=[],r._completeRowsContainer=new n.b,r._rowAnimationDuration=.5,r._animateDrop=!0,r._dropAnimationDuration=.2,r._dropTargetY=0,r._dropStartPos=0,r._gameOverAnimationDuration=2.4,r._gameOverCurtain=new n.c,r._unrotateDuration=r._gameOverAnimationDuration/3,r._cameraAdjustTime=.2,r._adjustCameraTarget=[0,0],r._adjustCameraSource=[0,0],r._flickerCounter=0,r._scanLinesTime=0,r._scanDuration=3,r._lastTetrominoAngle=d.Deg0,r._firstPersonMode=!0,r._lightsOutMode=!1,r._inCrisisMode=!1,r._playerX=0,r._playerY=0,r._hasWallKick=!0,r._hasLockDelay=!1,r._startingLevel=0,r._level=0,r._lines=0,r._statistics={},r._statisticsUi={},r._statsPiecesUi=new n.b,r._score=0,r._hiScore=1e4,r._flicker=new n.c,r._scanLines=new n.c,r._screenUiValues=new n.b,r._screen=new n.b,r._room=new n.b,r._leftHeld=!1,r._rightHeld=!1,r._downHeld=!1,r._xHoldTimer=0,r._yHoldTimer=0,r._holdMinDuration=.12,r._holdRepeatInterval=.06,r._forceCheckInput=!1,r._dropStartY=-1,r._yHoldStart=-1,r._gameOverInitRotation=0,r._gameOverInitPivotX=0,r._gameOverInitPivotY=0,r._panic=!1,r._touchControls=!1,r._touchContainer=new n.b,r._touchDpad=new n.b,r._touchButtons=new n.b,r.PRESS_DIR=((s={})[T.Left]=[r._pressLeft.bind(r),function(){},r._pressRight.bind(r),r._pressDown.bind(r)],s[T.Right]=[r._pressRight.bind(r),r._pressDown.bind(r),r._pressLeft.bind(r),function(){}],s[T.Down]=[r._pressDown.bind(r),r._pressLeft.bind(r),function(){},r._pressRight.bind(r)],s[T.Up]=[function(){},r._pressRight.bind(r),r._pressDown.bind(r),r._pressLeft.bind(r)],s),r.RELEASE_DIR=((o={})[T.Left]=[r._releaseLeft.bind(r),function(){},r._releaseRight.bind(r),r._releaseDown.bind(r)],o[T.Right]=[r._releaseRight.bind(r),r._releaseDown.bind(r),r._releaseLeft.bind(r),function(){}],o[T.Down]=[r._releaseDown.bind(r),r._releaseLeft.bind(r),function(){},r._releaseRight.bind(r)],o[T.Up]=[function(){},r._releaseRight.bind(r),r._releaseDown.bind(r),r._releaseLeft.bind(r)],o),void 0!==e.level&&(r._level=r._startingLevel=e.level,r._updateStepDuration()),void 0!==e.firstPerson&&(r._firstPersonMode=e.firstPerson),void 0!==e.hiScore&&(r._hiScore=e.hiScore),(window.location.hash.startsWith("#tps")||window.location.hash.indexOf(",tps")>=0)&&(r._firstPersonMode=!1,r._animateRotation=!1),r._screen.sortableChildren=!0,r._grid.position.x=O,r._grid.position.y=L,r._screen.addChild(r._grid),r._completeRowsContainer.position.x=O,r._completeRowsContainer.position.y=L,r._screen.addChild(r._completeRowsContainer);var a=new n.f(0,0,256,224);r._screenUi=new c(h.a.stage.texture,a),r._screenUi.scale.x=2,r._screenUi.scale.y=2,r._screenUi.zIndex=100,r._screen.addChild(r._screenUi),r._flicker.alpha=.05,r._flicker.zIndex=120,r._flicker.beginFill(0),r._flicker.drawRect(0,0,2*a.width,2*a.height),r._screen.addChild(r._flicker),r._scanLines.alpha=.15,r._scanLines.zIndex=125,r._scanLines.beginFill(0),r._scanLines.drawRect(0,0,2*a.width,176),r._screen.addChild(r._scanLines),r._levelUi=r._createUiText(("0"+r._level).substr(-2),416,314),r._linesUi=r._createUiText("000",304,26),r._scoreUi=r._createUiText("000000",384,106),r._hiScoreUi=r._createUiText(("00000"+r._hiScore).substr(-6),384,58),r._screenUiValues.zIndex=110,r._screen.addChild(r._screenUiValues);return["T","Z","J","O","L","S","I"].forEach(function(t,i){r._statistics[t]=0,r._statisticsUi[t]=r._createUiText("000",96,170+32*i,16267264)}),r._statsPiecesUi.position.x=48,r._statsPiecesUi.position.y=160,r._statsPiecesUi.zIndex=110,r._screen.addChild(r._statsPiecesUi),r._gameOverCurtain.position.x=O,r._gameOverCurtain.position.y=L,r._gameOverCurtain.zIndex=120,r._screen.addChild(r._gameOverCurtain),r._roomBg=n.i.from(h.a.room.texture),r._room.addChild(r._roomBg),r._screen.position.x=740,r._screen.position.y=768,r._screen.scale.x=425/(2*a.width),r._screen.scale.y=372/(2*a.height),r._room.addChild(r._screen),r._screenOverlay=n.i.from(h.a.screen.texture),r._screenOverlay.position.x=733,r._screenOverlay.position.y=584,r._room.addChild(r._screenOverlay),r._room.pivot.x=h.a.room.texture.width/2,r._room.pivot.y=h.a.room.texture.height/2,r._room.scale.x=1.25,r._room.scale.y=1.25,r.stage.addChild(r._room),r._nextTetromino=r._getNextTetromino(),r._currentTetromino=r._spawnTetromino(),void 0!==e.lightsOut&&(r._lightsOutMode=e.lightsOut,r._updateLightsOutMode()),void 0!==e.crisisMode&&(r._inCrisisMode=e.crisisMode,r._updateCrisisMode()),!0===e.touchControls&&(r._touchControls=!0,r._setupTouchControls()),r._updateColors(),r._updateScreenPos(),r._updateScreenRotation(),r}return a.b(i,t),i.prototype._getColors=function(){return b[this._level%b.length]},i.prototype._updateColors=function(){var t=this._getColors(),i=t[0],e=t[1];this._grid.setColors(i,e),this._nextTetromino.setColors(i,e),this._currentTetromino.setColors(i,e),this._statsPiecesUi.removeChildren();var s=new n.f(24,80,24,112),o=new n.c;o.beginFill(i),o.drawRect(0,0,2*s.width,2*s.height),o.endFill(),o.beginFill(e),o.drawRect(2,72,38,26),o.drawRect(2,166,38,26),o.endFill(),this._statsPiecesUi.addChild(o);var r=new c(h.a.stage.texture,s);r.scale.x=2,r.scale.y=2,this._statsPiecesUi.addChild(r)},i.prototype._createUiText=function(t,i,e,s){void 0===s&&(s=16777215);var o=new n.j(t,{fontFamily:"main",fontSize:82,fill:s});return o.position.x=i,o.position.y=e,o.scale.x=.25,o.scale.y=.25,o.resolution=2,o.roundPixels=!0,o.visible=!this._lightsOutMode,this._screenUiValues.addChild(o),o},i.prototype.onEnter=function(i){if(t.prototype.onEnter.call(this,i),void 0!==i&&(this._lightsOutMode!==i.lightsOut&&(this._lightsOutMode=i.lightsOut,this._updateLightsOutMode()),this._inCrisisMode!==i.crisisMode&&(this._inCrisisMode=i.crisisMode,this._updateCrisisMode()),!this._touchControls&&i.touchControls)){this._touchControls=!0,this._setupTouchControls();var e=this.app.getSize(),s=e.width,o=e.height;this.onResize(s,o)}},i.prototype.onUpdate=function(t){this._state!==k.Paused&&(this._state===k.Idle&&this._updateIdle(t),this._state===k.RotationAnimation&&this._updateRotation(t),this._state===k.RowAnimation&&this._updateRowAnimation(t),this._state===k.DropAnimation&&this._updateDropAnimation(t),this._state===k.GameOver&&this._updateGameOver(t),this._state===k.AdjustingCamera&&this._updateCameraAdjustment(t),this._updateFlicker(t))},i.prototype.onProcessInput=function(i,e){var s=this,o=[T.Left,T.Right,T.Down,T.Up],n=this._effectiveAngle(),r=i.getFor(0);if(r.isPressed(T.Pause)&&this._pause(),o.forEach(function(t){r.isReleased(t)&&s._releaseAction(t,n)}),this._state===k.Idle){if(o.forEach(function(t){(r.isPressed(t)||s._forceCheckInput&&r.isDown(t))&&(s._pressAction(t,n),s._forceCheckInput=!1)}),r.isPressed(T.Rotate)&&this._rotate(),r.isPressed(T.Drop)&&this._hardDrop(),(this._leftHeld||this._rightHeld)&&(this._xHoldTimer+=e,this._xHoldTimer>this._holdRepeatInterval+this._holdMinDuration)){var a=this._xHoldTimer-this._holdMinDuration;this._xHoldTimer=this._holdMinDuration+a%this._holdRepeatInterval,this._leftHeld?this._moveLeft():this._moveRight()}if(this._downHeld&&(this._yHoldTimer+=e,this._yHoldTimer>this._holdRepeatInterval+this._holdMinDuration)){a=this._yHoldTimer-this._holdMinDuration;this._yHoldTimer=this._holdMinDuration+a%this._holdRepeatInterval,-1===this._yHoldStart&&(this._yHoldStart=this._playerY),this._moveDown()}}t.prototype.onProcessInput.call(this,i,e)},i.prototype._effectiveAngle=function(){return(this._lastTetrominoAngle+this._currentTetromino.getAngle())%4},i.prototype._pressAction=function(t,i){void 0===i&&(i=this._effectiveAngle()),this._firstPersonMode?this.PRESS_DIR[t][i]():t===T.Left?this._pressLeft():t===T.Right?this._pressRight():t===T.Down&&this._pressDown()},i.prototype._releaseAction=function(t,i){void 0===i&&(i=this._effectiveAngle()),this._firstPersonMode?this.RELEASE_DIR[t][i]():t===T.Left?this._releaseLeft():t===T.Right?this._releaseRight():t===T.Down&&this._releaseDown()},i.prototype._pressLeft=function(){this._moveLeft(),this._leftHeld=!0,this._xHoldTimer=0},i.prototype._releaseLeft=function(){this._leftHeld=!1},i.prototype._pressRight=function(){this._moveRight(),this._rightHeld=!0,this._xHoldTimer=0},i.prototype._releaseRight=function(){this._rightHeld=!1},i.prototype._pressDown=function(){this._moveDown(),this._downHeld=!0,this._yHoldTimer=0},i.prototype._releaseDown=function(){this._downHeld=!1,this._yHoldStart=-1},i.prototype._getNextTetromino=function(){var t=S.getRandom();this._currentTetromino&&t.name===this._currentTetromino.name&&(t=S.getRandom());var i=this._getColors(),e=i[0],s=i[1];t.setColors(e,s);var o=t.getCenter(),n=o[0],r=o[1];return t.setX(384+f*(2-n)),t.setY(210+f*(2-r)),t.visible=!this._lightsOutMode,this._screen.addChild(t),t},i.prototype._spawnTetromino=function(){this._currentTetromino&&(this._screen.removeChild(this._currentTetromino),this._lastTetrominoAngle=(this._lastTetrominoAngle+this._currentTetromino.getAngle())%4);var t=this._nextTetromino;for(t.visible=!0,this._increaseStatistics(t.getName()),this._nextTetromino=this._getNextTetromino(),this._playerX=Math.ceil(m/2-t.getSize()/2),this._playerY=-t.getSize();this._playerY<-t.getOffset()&&!this._grid.collidesWith(t,this._playerX,this._playerY+1);++this._playerY);return t.setX(O+f*this._playerX),t.setY(L+f*this._playerY),this._stepTime=0,this._playerY<-t.getOffset()&&this._initGameOver(),t},i.prototype._updateIdle=function(t){this._stepTime+=t,this._stepTime>this._stepDuration&&(this._stepTime=this._stepTime%this._stepDuration,this._downHeld||this._performStep())},i.prototype._performStep=function(){this._moveDown()},i.prototype._updateRotation=function(t){this._animationTime+=t,this._animationTime>this._rotationDuration&&(this._animationTime=this._rotationDuration,this.setState(k.Idle));var i=this._animationTime/this._rotationDuration;this._currentTetromino.angle=90*i-90,this._updateScreenRotation()},i.prototype._updateRowAnimation=function(t){var i=this;if(this._animationTime===this._rowAnimationDuration)return this.setState(k.Idle),this._updateLevel(),this._completeRows.forEach(function(t){var e=t.row;i._grid.removeRow(e)}),this._grid.update(),this._postUnite(),void this._completeRowsContainer.removeChildren();this._animationTime+=t,this._animationTime>this._rowAnimationDuration&&(this._animationTime=this._rowAnimationDuration);var e=Math.ceil(m/2),s=this._rowAnimationDuration/e/2,o=(this._rowAnimationDuration-s)/e,n=o+s,r=m%2==1,a=Math.floor(m/2);if(r){var h=1-Math.max(Math.min(this._animationTime/n,1),0);this._completeRowsBlocks.forEach(function(t){var i=t[a];i.scale.x=h,i.scale.y=h})}for(var p=function(t){var i=1-Math.max(Math.min((c._animationTime-t*o)/n,1),0);c._completeRowsBlocks.forEach(function(e){var s=e[a-t-1];s.scale.x=i,s.scale.y=i;var o=e[a+t];o.scale.x=i,o.scale.y=i})},c=this,u=r?1:0;u<a;++u)p(u)},i.prototype._moveLeft=function(){this._grid.collidesWith(this._currentTetromino,this._playerX-1,this._playerY)||(this._playerX--,this._currentTetromino.setX(O+this._playerX*f),this._updateScreenPos())},i.prototype._moveRight=function(){this._grid.collidesWith(this._currentTetromino,this._playerX+1,this._playerY)||(this._playerX++,this._currentTetromino.setX(O+this._playerX*f),this._updateScreenPos())},i.prototype._moveDown=function(t){void 0===t&&(t=!1),this._grid.collidesWith(this._currentTetromino,this._playerX,this._playerY+1)?this._uniteTetromino():(this._playerY++,this._currentTetromino.setY(L+this._playerY*f),this._updateScreenPos(),t&&(this._stepTime=0))},i.prototype._rotate=function(){var t=(this._currentTetromino.getAngle()+1)%4,i=this._playerX,e=this._playerY,s=this._grid.collidesWith(this._currentTetromino,i,e,t),o=Math.floor(this._currentTetromino.getSize()/2);if(s&&this._hasWallKick)for(var n=void 0,r=1;r<=o;++r){if(n=this._playerX-r,!(s=this._grid.collidesWith(this._currentTetromino,n,e,t))){i=n;break}if(n=this._playerX+r,!(s=this._grid.collidesWith(this._currentTetromino,n,e,t))){i=n;break}}s||this._initRotation(t,i,e)},i.prototype._hardDrop=function(){for(this._dropStartY=Math.max(0,this._playerY),this._dropTargetY=this._playerY;!this._grid.collidesWith(this._currentTetromino,this._playerX,this._dropTargetY+1);)this._dropTargetY++;this._animateDrop?(this.setState(k.DropAnimation),this._animationTime=0,this._dropStartPos=this._currentTetromino.position.y-this._currentTetromino.pivot.y):(this._playerY=this._dropTargetY,this._uniteTetromino())},i.prototype._uniteTetromino=function(){var t=this._grid.unite(this._currentTetromino,this._playerX,this._playerY);this._grid.update(),this._currentTetromino.visible=!1,t.length>0?this._initRowsAnimation(t):(this._increaseDropScore(),this.app.sound.playSfx("united"),this._postUnite())},i.prototype._initRotation=function(t,i,e){void 0===i&&(i=this._playerX),void 0===e&&(e=this._playerY),this.app.sound.playSfx("rotate"),this._playerX=i,this._playerY=e,this._currentTetromino.setAngle(t),this._currentTetromino.setX(O+this._playerX*f),this._currentTetromino.setY(L+this._playerY*f),this._currentTetromino.update(),this._updateScreenPos(),this._hasLockDelay&&this._grid.collidesWith(this._currentTetromino,this._playerX,this._playerY+1)&&(this._stepTime=0),this._animateRotation?(this._animationTime=0,this._currentTetromino.angle=-90,this.setState(k.RotationAnimation)):this._updateScreenRotation(),this._firstPersonMode&&(this._leftHeld=!1,this._rightHeld=!1,this._downHeld=!1,this._yHoldStart=-1)},i.prototype._initRowsAnimation=function(t){var i=this;this._completeRows=t,this._increaseLineCount(t.length),this._increaseLineScore(t.length),this._increaseDropScore(),t.length<4?this.app.sound.playSfx("line"):this.app.sound.playSfx("tetris"),this._completeRowsContainer.removeChildren(),this._completeRowsBlocks=[];var e=this._getColors();t.forEach(function(t){var s=t.row,n=t.blocks.map(function(t,n){var r=e[(t-1)%2],a=1===t?o.Block1:o.Block2,h=new _(r,a);return i._completeRowsContainer.addChild(h),h.pivot.x=Math.floor(u/2),h.pivot.y=Math.floor(u/2),h.position.x=n*f+h.pivot.x,h.position.y=s*f+h.pivot.y,h});i._completeRowsBlocks.push(n)}),this._animationTime=0,this.setState(k.RowAnimation)},i.prototype._setLevel=function(t){this._level!==t&&(this._level=t,this._levelUi.text=("0"+t).substr(-2),this._updateStepDuration(),this._updateColors(),this.app.sound.playSfx("level"))},i.prototype._updateStepDuration=function(){this._stepDuration=C[this._level]||.017},i.prototype._increaseStatistics=function(t){var i=++this._statistics[t];this._statisticsUi[t].text=("00"+i).substr(-3)},i.prototype._increaseLineCount=function(t){void 0===t&&(t=1),this._lines+=t,this._linesUi.text=("00"+this._lines).substr(-3)},i.prototype._increaseLineScore=function(t){void 0===t&&(t=1);var i=x[Math.min(t-1,3)]*(this._level+1);this._score+=i,this._updateScore()},i.prototype._updateLevel=function(){var t=Math.floor(this._lines/10)+this._startingLevel;this._setLevel(t)},i.prototype._updateDropAnimation=function(t){if(this._animationTime===this._dropAnimationDuration)return this._playerY=this._dropTargetY,this.setState(k.Idle),void this._uniteTetromino();this._animationTime+=t,this._animationTime>this._dropAnimationDuration&&(this._animationTime=this._dropAnimationDuration);var i=this._animationTime/this._dropAnimationDuration,e=L+this._dropTargetY*f-this._dropStartPos;this._currentTetromino.setY(this._dropStartPos+e*i*i),this._updateScreenPos()},i.prototype._initGameOver=function(){this.app.sound.playSfx("over"),this.setState(k.GameOver),this._animationTime=0;var t=new n.a({width:16,height:16,scaleMode:n.h.NEAREST,resolution:1});this._curtainTexture=new n.g(t);var i=this._getColors(),e=i[0],s=i[1],o=new n.c;o.beginFill(0),o.drawRect(0,0,16,16),o.beginFill(s),o.drawRect(0,0,16,4),o.beginFill(16777215),o.drawRect(0,4,16,6),o.beginFill(e),o.drawRect(0,10,16,4),this.app.renderer.render(o,this._curtainTexture),this._gameOverInitRotation=this._room.angle,this._gameOverInitPivotX=this._room.pivot.x,this._gameOverInitPivotY=this._room.pivot.y},i.prototype._updateGameOver=function(t){this._animationTime===this._gameOverAnimationDuration&&this.manager.switchTo(new $(this.app,{gameOver:{level:this._level,lines:this._lines,score:this._score,hiScore:this._hiScore,panic:this._panic}})),this._animationTime=this._animationTime+t,this._animationTime>this._gameOverAnimationDuration&&(this._animationTime=this._gameOverAnimationDuration);var i=this._animationTime/this._gameOverAnimationDuration,e=this._gameOverCurtain;e.clear(),e.beginTextureFill(this._curtainTexture),e.drawRect(0,0,m*f,v*f*i);var s=Math.min(this._animationTime,this._unrotateDuration)/this._unrotateDuration,o=1-s,n=this._gameOverInitRotation;n>180&&(n-=360),n<-180&&(n+=360),this._room.angle=n*o,this._room.pivot.x=this._gameOverInitPivotX*o+this._room.width/2/this._room.scale.x*s,this._room.pivot.y=this._gameOverInitPivotY*o+this._room.height/2/this._room.scale.y*s},i.prototype.onResize=function(i,e){var s=this._inCrisisMode?12*f:1300,o=this._inCrisisMode?12*f:1300,n=1.25;if(i>s&&(n=i/s),e>o*n&&(n=e/o),1.25===n){var r=this._inCrisisMode?10*f:1.1*h.a.screen.texture.width,a=this._inCrisisMode?12*f:1.1*h.a.screen.texture.height;i<r&&(n=i/r),e<a*n&&(n=e/a)}if(this._room.position.x=i/2,this._room.position.y=e/2,this._room.scale.x=n,this._room.scale.y=n,this._touchControls){var p=i/e<.625;this._touchContainer.position.x=i/2,this._touchContainer.position.y=e,this._touchButtons.position.x=i/2,this._touchButtons.position.y=-60,this._touchDpad.position.x=-i/2,this._touchDpad.position.y=-60,p?this._room.position.y=(e-200)/2:(this._room.scale.x*=1.5,this._room.scale.y*=1.5)}t.prototype.onResize.call(this,i,e)},i.prototype._updateScreenPos=function(t){if(void 0===t&&(t=!1),this._firstPersonMode){var i=this._currentTetromino,e=i.getCenter(),s=e[0],o=e[1],n=i.position.x-i.pivot.x+s*f,r=i.position.y-i.pivot.y+o*f,a=this._screen.scale.x*n+this._screen.position.x,h=this._screen.scale.y*r+this._screen.position.y;t&&this._state===k.Idle?(this._adjustCameraTarget=[a,h],this._adjustCameraSource=[this._room.pivot.x,this._room.pivot.y],this._animationTime=0,this.setState(k.AdjustingCamera)):(this._room.pivot.x=a,this._room.pivot.y=h)}},i.prototype._updateScreenRotation=function(){if(this._firstPersonMode){var t=this._currentTetromino,i=t.getAngle(),e=this._lastTetrominoAngle;this._room.angle=90*-e-90*i-t.angle}},i.prototype._updateCameraAdjustment=function(t){this._animationTime===this._cameraAdjustTime&&this.setState(k.Idle),this._animationTime+=t,this._animationTime>this._cameraAdjustTime&&(this._animationTime=this._cameraAdjustTime);var i=this._animationTime/this._cameraAdjustTime,e=this._adjustCameraTarget,s=e[0],o=e[1],n=this._adjustCameraSource,r=n[0],a=n[1];this._room.pivot.x=r+(s-r)*i,this._room.pivot.y=a+(o-a)*i},i.prototype._pause=function(){var t={level:this._level,lines:this._lines,score:this._score,hiScore:this._hiScore,panic:this._panic};this.manager.push(new $(this.app,{pause:t}))},i.prototype._updateLightsOutMode=function(){var t=!this._lightsOutMode;this._screenUi.visible=t,this._screenUiValues.visible=t,this._screenOverlay.visible=t,this._roomBg.visible=t,this._nextTetromino.visible=t,this._statsPiecesUi.visible=t,this._flicker.visible=t,this._scanLines.visible=t},i.prototype._updateCrisisMode=function(){var t=this.app.getSize(),i=t.width,e=t.height;this.onResize(i,e)},i.prototype._updateFlicker=function(t){this._flicker.alpha=.02+Math.floor(this._flickerCounter++/4)%3*.02,this._scanLinesTime+=t;var i=this._scanLinesTime%this._scanDuration/this._scanDuration;this._scanLines.position.y=582*i-177},i.prototype._increaseDropScore=function(t){void 0===t&&(t=this._playerY);var i=this._level+1,e=0;-1!==this._dropStartY?e=(t-this._dropStartY)*i:-1!==this._yHoldStart&&(e=(t-this._yHoldStart)*i),e>0&&(this._score+=e,this._updateScore()),this._dropStartY=-1,this._yHoldStart=-1},i.prototype._updateScore=function(){this._scoreUi.text=("00000"+this._score).substr(-6),this._score>this._hiScore&&(this._hiScore=this._score,this._hiScoreUi.text=this._scoreUi.text)},i.prototype._postUnite=function(){this._currentTetromino=this._spawnTetromino(),this._updateScreenPos(!0),this._updateScreenRotation(),this._panic!==this._grid.shouldPanic()&&(this._panic=this._grid.shouldPanic(),this._inCrisisMode||(this.app.sound.stopMusic(),this._panic?this.app.sound.playFastMusic():this.app.sound.playSlowMusic()))},i.prototype._setupTouchControls=function(){var t=this,i=h.a.onScreenControls.texture,e=new c(h.a.ui.texture,new n.f(16,34,14,14));e.scale.x=2,e.scale.y=2,e.position.x=16,e.position.y=16,e.interactive=!0,e.on("touchstart",function(){t._pause()}),this.stage.addChild(e),this._touchContainer.addChild(this._touchButtons);var s=new n.f(213,0,173,175),o=new n.f(391,0,173,175),r=new c(i,s);r.pivot.x=s.width,r.pivot.y=s.height,r.setSize(110,110),r.interactive=!0,r.on("touchstart",function(){r.setSubRect(o),t._state===k.Idle&&t._rotate()});var a=function(){r.setSubRect(s)};r.on("touchend",a),r.on("touchendoutside",a),this._touchButtons.addChild(r);var p=new c(i,s);p.pivot.x=s.width,p.pivot.y=s.height-30,p.position.x=-110,p.setSize(60,60),p.interactive=!0,p.on("touchstart",function(){p.setSubRect(o),t._state===k.Idle&&t._hardDrop()});var u=function(){p.setSubRect(s)};p.on("touchend",u),p.on("touchendoutside",u),this._touchButtons.addChild(p),this._touchContainer.addChild(this._touchDpad);var d=new n.f(0,0,208,206),l=new n.f(0,211,208,206),_=new n.f(213,211,208,206),f=new n.f(426,211,208,206),m=new n.f(639,211,208,206),v=null,y=new c(i,d);y.pivot.y=d.height-30,y.setSize(180,180),this._touchDpad.addChild(y);var g=new n.b;g.position.x=62,g.position.y=0,g.hitArea=new n.f(0,0,80,80),g.interactive=!0,g.on("touchstart",function(){y.setSubRect(_),v=T.Up,t._state===k.Idle&&t._pressAction(T.Up)});var w=function(){t._releaseAction(T.Up),v===T.Up&&(y.setSubRect(d),v=null)};g.on("touchend",w),g.on("touchendoutside",w),y.addChild(g);var S=new n.b;S.position.x=62,S.position.y=123,S.hitArea=new n.f(0,0,80,80),S.interactive=!0,S.on("touchstart",function(){y.setSubRect(l),v=T.Down,t._state===k.Idle&&t._pressAction(T.Down)});var x=function(){t._releaseAction(T.Down),v===T.Down&&(y.setSubRect(d),v=null)};S.on("touchend",x),S.on("touchendoutside",x),y.addChild(S);var b=new n.b;b.position.x=0,b.position.y=60,b.hitArea=new n.f(0,0,80,80),b.interactive=!0,b.on("touchstart",function(){y.setSubRect(m),v=T.Left,t._state===k.Idle&&t._pressAction(T.Left)});var C=function(){t._releaseAction(T.Left),v===T.Left&&(y.setSubRect(d),v=null)};b.on("touchend",C),b.on("touchendoutside",C),y.addChild(b);var R=new n.b;R.position.x=128,R.position.y=60,R.hitArea=new n.f(0,0,80,80),R.interactive=!0,R.on("touchstart",function(){y.setSubRect(f),v=T.Right,t._state===k.Idle&&t._pressAction(T.Right)});var D=function(){v===T.Right&&(y.setSubRect(d),v=null),t._releaseAction(T.Right)};R.on("touchend",D),R.on("touchendoutside",D),y.addChild(R),this.stage.addChild(this._touchContainer)},i.prototype.setState=function(t){this._state!==t&&(this._state=t,this._forceCheckInput=t===k.Idle)},i}(p),E=function(t){function i(i,e){void 0===e&&(e=!1);var s=t.call(this)||this;return s._checkFiller=new n.c,s._checked=e,s._checkFiller.beginFill(16777215),s._checkFiller.drawRect(5,5,20,20),s._checkFiller.endFill(),s._checkFiller.visible=e,s.addChild(s._checkFiller),s._checkSquare=new c(h.a.ui.texture,new n.f(0,34,15,15)),s._checkSquare.scale.x=2,s._checkSquare.scale.y=2,s.addChild(s._checkSquare),s._label=new n.j(i,{fontFamily:"main",fontSize:24,fill:e?16777215:8158332}),s._label.position.x=42,s._label.position.y=0,s.interactive=!0,s.buttonMode=!0,s.hitArea=new n.f(0,0,s._label.position.x+s._label.width,s._checkSquare.height),s.addChild(s._label),s}return a.b(i,t),i.prototype.setChecked=function(t){this._checked!==t&&(this._checked=t,this._checkFiller.visible=t,this._label.style.fill=t?16777215:8158332)},i}(n.b),U=e("1xzG"),I=e.n(U),F=e("iUa2"),Y=e.n(F),z=e("jk+9"),H=e.n(z),X=e("rtd/"),B=e.n(X),j=e("Bvue"),G=e.n(j),K=e("cmuR"),q=e.n(K),N=e("72YK"),W=e.n(N),V=640,J=480,Z=[[Y.a,H.a],[B.a,G.a],[q.a,W.a]],Q={fontFamily:"main",fontSize:24,fill:16777215},$=function(t){function i(i,e){void 0===e&&(e={});var s=t.call(this,i)||this;return s.container=new n.b,s.musicCheckboxes=[],s.selectedMusic=0,s.sfxOn=!0,s.lightsOut=!1,s.inCrisis=!1,s.hiScore=1e4,s.isPaused=!1,s.panicMode=!1,s.loadSettings(),s.app.sound.setSfxEnabled(s.sfxOn),void 0!==e.pause?s.setupPauseMenu(e.pause):void 0!==e.gameOver?s.setupGameOverMenu(e.gameOver):s.setupTitleMenu(),s.container.pivot.x=Math.floor(V/2),s.container.pivot.y=Math.floor(J/2),s.stage.addChild(s.container),s}return a.b(i,t),i.prototype.setupTitleMenu=function(){this.drawControlsSection("IT'S FIRST-PERSON TETRIS"),this.drawMusicSection(),this.drawOptionsSection(),this.drawStartButton(),this.drawCreditsText()},i.prototype.setupPauseMenu=function(t){this.isPaused=!0,this.panicMode=t.panic,this.app.sound.playSfx("pause"),this.drawStageDataSection("PAUSED",t),this.drawMusicSection(),this.drawOptionsSection(),this.drawStartButton(),this.drawCreditsText()},i.prototype.setupGameOverMenu=function(t){this.app.sound.stopMusic(),this.hiScore=t.hiScore,this.saveSettings(),this.drawStageDataSection("GAME OVER",t),this.drawMusicSection(),this.drawOptionsSection(),this.drawStartButton(),this.drawCreditsText()},i.prototype.drawTitleText=function(t,i,e){var s=new n.j(t,Q);s.position.x=i,s.position.y=e,this.container.addChild(s)},i.prototype.drawControlsSection=function(t){this.drawTitleText(t,24,24);var i={fontFamily:"main",fontSize:18,fill:8158332},e=new c(h.a.ui.texture,new n.f(0,0,51,33));e.scale.x=2,e.scale.y=2,e.position.x=24,e.position.y=64,this.container.addChild(e);var s=new n.j("MOVE",i);s.position.x=e.position.x+(e.width-s.width)/2,s.position.y=136,this.container.addChild(s);var o=new c(h.a.ui.texture,new n.f(52,38,75,15));o.scale.x=2,o.scale.y=2,o.position.x=181,o.position.y=100,this.container.addChild(o);var r=new n.j("ROTATE",i);r.position.x=o.position.x+(o.width-r.width)/2,r.position.y=136,this.container.addChild(r);var a=new c(h.a.ui.texture,new n.f(52,0,53,18));a.scale.x=2,a.scale.y=2,a.position.x=386,a.position.y=94,this.container.addChild(a);var p=new n.j("DROP",i);p.position.x=a.position.x+(a.width-p.width)/2,p.position.y=136,this.container.addChild(p);var u=new c(h.a.ui.texture,new n.f(52,19,35,18));u.scale.x=2,u.scale.y=2,u.position.x=547,u.position.y=94,this.container.addChild(u);var d=new n.j("PAUSE",i);d.position.x=u.position.x+(u.width-d.width)/2,d.position.y=136,this.container.addChild(d)},i.prototype.drawStageDataSection=function(t,i){this.drawTitleText(t,24,24);var e={fontFamily:"main",fontSize:18,fill:8158332},s={fontFamily:"main",fontSize:18,fill:16777215},o=new n.j("LEVEL",e);o.position.x=38,o.position.y=64,this.container.addChild(o);var r=new n.j("LINES",e);r.position.x=38,r.position.y=84,this.container.addChild(r);var a=new n.j("SCORE",e);a.position.x=38,a.position.y=104,this.container.addChild(a);var h=new n.j("TOP SCORE",e);h.position.x=38,h.position.y=124,this.container.addChild(h);var p=new n.j(i.level.toString(),s);p.position.x=180,p.position.y=64,this.container.addChild(p);var c=new n.j(i.lines.toString(),s);c.position.x=180,c.position.y=84,this.container.addChild(c);var u=new n.j(i.score.toString(),s);u.position.x=180,u.position.y=104,this.container.addChild(u);var d=new n.j(i.hiScore.toString(),s);d.position.x=180,d.position.y=124,this.container.addChild(d)},i.prototype.drawMusicSection=function(){this.drawTitleText("MUSIC",24,180),this.musicCheckboxes=new Array(4);for(var t=0;t<4;++t){var i=t===this.selectedMusic,e=!i||!this.app.sound.isMusicPlaying(),s=new E(3===t?"OFF":"TYPE"+(t+1),i);s.position.x=38+160*t,s.position.y=220,s.interactive=e,s.buttonMode=e,s.on("pointertap",this.actionSelectMusic.bind(this,t)),this.container.addChild(s),this.musicCheckboxes[t]=s}},i.prototype.drawOptionsSection=function(){this.drawTitleText("OPTIONS",24,280);var t=new E("SFX",this.sfxOn);t.position.x=38,t.position.y=320,t.on("pointertap",this.actionToggleSfx.bind(this,t)),this.container.addChild(t);var i=new E("LIGHTS OUT",this.lightsOut);i.position.x=168,i.position.y=320,i.on("pointertap",this.actionToggleLightsOut.bind(this,i)),this.container.addChild(i);var e=new E("IN CRISIS",this.inCrisis);e.position.x=418,e.position.y=320,e.on("pointertap",this.actionToggleCrisisMode.bind(this,e)),this.container.addChild(e)},i.prototype.drawStartButton=function(){var t=this.isPaused?"RESUME":"PUSH START",i=this.isPaused?this.actionResumeGame:this.actionStartGame,e=new n.j(t,{fontFamily:"main",fontSize:32,fill:3980540});e.position.x=Math.floor((V-e.width)/2),e.position.y=376,e.interactive=!0,e.buttonMode=!0,e.on("tap",i.bind(this,!0)),e.on("click",i.bind(this,!1)),this.container.addChild(e)},i.prototype.drawCreditsText=function(){var t={fontFamily:"main",fontSize:12,fill:8158332},i={fontFamily:"main",fontSize:12,fill:11184810},e=new n.j("Made by ",t),s=new n.j("@sdrmme",i);e.position.x=(V-e.width-s.width)/2,e.position.y=J-32,this.container.addChild(e),s.position.x=e.position.x+e.width,s.position.y=e.position.y,s.interactive=!0,s.buttonMode=!0,s.on("pointertap",function(){window.open("https://twitter.com/sdrmme","_blank")}),this.container.addChild(s);var o=new n.j("Based on work by ",t),r=new n.j("@dontsave",i);o.position.x=(V-o.width-r.width)/2,o.position.y=J-16,this.container.addChild(o),r.position.x=o.position.x+o.width,r.position.y=o.position.y,r.interactive=!0,r.buttonMode=!0,r.on("pointertap",function(){window.open("https://twitter.com/dontsave","_blank")}),this.container.addChild(r)},i.prototype.loadSettings=function(){var t=window.localStorage.getItem("settings");if(t)try{var i=JSON.parse(t);this.hiScore=i.hiScore,this.selectedMusic=i.music,this.sfxOn=i.sfx,this.lightsOut=i.lightsOut,this.inCrisis=i.crisis}catch(t){}},i.prototype.saveSettings=function(){var t={hiScore:this.hiScore,music:this.selectedMusic,sfx:this.sfxOn,lightsOut:this.lightsOut,crisis:this.inCrisis};window.localStorage.setItem("settings",JSON.stringify(t))},i.prototype.playMusic=function(t){void 0===t&&(t=this.selectedMusic);var i=this.app.sound;if(this.inCrisis)return i.setMusic(I.a,I.a),void i.playSlowMusic();if(t>=3)i.removeMusic();else{var e=Z[t],s=e[0],o=e[1];i.setMusic(s,o),this.panicMode?i.playFastMusic():i.playSlowMusic()}},i.prototype.actionSelectMusic=function(t){this.selectedMusic=t,this.saveSettings(),this.inCrisis&&this.app.sound.isMusicPlaying()||this.playMusic(this.selectedMusic),this.musicCheckboxes.forEach(function(i,e){var s=e===t;i.setChecked(s),i.interactive=!s,i.buttonMode=!s}),this.app.sound.playSfx("beep")},i.prototype.actionToggleSfx=function(t){this.sfxOn=!this.sfxOn,t.setChecked(this.sfxOn),this.app.sound.setSfxEnabled(this.sfxOn),this.app.sound.playSfx("beep"),this.saveSettings()},i.prototype.actionToggleLightsOut=function(t){this.lightsOut=!this.lightsOut,t.setChecked(this.lightsOut),this.app.sound.playSfx("beep"),this.saveSettings()},i.prototype.actionToggleCrisisMode=function(t){this.inCrisis=!this.inCrisis,t.setChecked(this.inCrisis),this.app.sound.playSfx("beep"),this.inCrisis?(this.app.sound.setMusic(I.a,I.a),this.app.sound.playSlowMusic()):this.playMusic(),this.saveSettings()},i.prototype.actionStartGame=function(t){void 0===t&&(t=!1),t&&this.requestFullscreen(),this.app.sound.playSfx("beep"),this.app.sound.isMusicPlaying()||this.playMusic(),this.manager.switchTo(new P(this.app,{hiScore:this.hiScore,lightsOut:this.lightsOut,crisisMode:this.inCrisis,touchControls:t}))},i.prototype.actionResumeGame=function(t){void 0===t&&(t=!1),t&&this.requestFullscreen(),this.app.sound.playSfx("pause"),this.manager.pop({lightsOut:this.lightsOut,crisisMode:this.inCrisis,touchControls:t})},i.prototype.onResize=function(i,e){var s=1;i<V&&(s=i/V),e<J*s&&(s=e/J),this.container.position.x=Math.floor(i/2),this.container.position.y=Math.floor(e/2),this.container.scale.x=s,this.container.scale.y=s,t.prototype.onResize.call(this,i,e)},i.prototype.onProcessInput=function(t){var i=t.getFor(0);this.isPaused?i.isPressed(T.Pause)&&this.actionResumeGame():i.isPressed(T.Pause|T.Drop|T.Rotate)&&this.actionStartGame()},i.prototype.requestFullscreen=function(){var t=document.body;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},i}(p),tt=function(){function t(t){var i=this;this.index=0,this.oldState=0,this.currentState=0,this.newState=0,this.axes={},this.index=t,window.addEventListener("blur",function(){i.reset()},!1)}return t.prototype.isPressed=function(t){return this.currentState&t&~(this.oldState&t)},t.prototype.isReleased=function(t){return~(this.currentState&t)&this.oldState&t},t.prototype.isDown=function(t){return this.currentState&t},t.prototype.reset=function(){var t=this;this.newState=0,Object.keys(this.axes).forEach(function(i){t.axes[i]=0})},t.prototype.update=function(){this.oldState=this.currentState,this.currentState=this.newState},t}(),it=function(){function t(i,e){this.eventKeyAttr=t.isLevel3Supported()?"code":"keyCode",this.mapping=i,this.player=e,e&&e.reset(),this.onKeyDown=this.onKeyDown.bind(this),window.addEventListener("keydown",this.onKeyDown,!1),this.onKeyUp=this.onKeyUp.bind(this),window.addEventListener("keyup",this.onKeyUp,!1)}return t.isLevel3Supported=function(){return void 0!==new KeyboardEvent("dummy").code},t.prototype.destroy=function(){window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("keydown",this.onKeyDown)},t.prototype.setPlayer=function(t){t!==this.player&&(this.player&&this.player.reset(),t&&t.reset()),this.player=t},t.prototype.setMapping=function(t){this.mapping=t,this.player&&this.player.reset()},t.prototype.onKeyDown=function(t){if(void 0!==this.player){var i=t[this.eventKeyAttr].toString(),e=this.mapping.keys[i];if(void 0!==e){t.preventDefault(),this.player.newState|=e;var s=this.mapping.keyAxes[e];if(void 0!==s){var o=void 0===s.factor?1:s.factor;this.player.axes[s.axis]=o}}}},t.prototype.onKeyUp=function(t){if(void 0!==this.player){var i=t[this.eventKeyAttr].toString(),e=this.mapping.keys[i];if(void 0!==e){t.preventDefault(),this.player.newState&=~e;var s=this.mapping.keyAxes[e];if(void 0!==s){var o=s.opposite;if(void 0!==o&&this.player.isDown(o)){var n=void 0===s.factor?1:s.factor;this.player.axes[s.axis]=-1*n}else this.player.axes[s.axis]=0}}}},t}(),et=function(){function t(t,i,e){this.buttonState={},this.buttonValues={},this.axisState={},this.index=t.index,this.mapping=i,this.player=e,e&&e.reset()}return t.prototype.destroy=function(){},t.prototype.setPlayer=function(t){t!==this.player&&(this.player&&this.player.reset(),t&&t.reset())},t.prototype.setMapping=function(t){this.mapping=t,this.player&&this.player.reset()},t.prototype.update=function(){var t=this;if(this.player){var i=this.player,e=navigator.getGamepads()[this.index];if(null!==e){e.buttons.forEach(function(e,s){var o=e.pressed,n=t.mapping.buttons[s];void 0!==n&&t.buttonState[s]!==o&&(o?i.newState|=n:i.newState&=~n,t.buttonState[s]=o)});var s={};e.axes.forEach(function(e,o){var n=t.mapping.axes[o];if(void 0!==n){var r=Math.floor(100*e)/100;if(t.axisState[o]!==r){if(n instanceof Object){var a=n;if(a.range===g.Hat&&a.targetY){if(r>1||r<-1)i.axes[a.target]=0,i.axes[a.targetY]=0;else{var h=7*(1+r)/8-1,p=-Math.sin(h*Math.PI),c=Math.cos(h*Math.PI);i.axes[a.target]=p,i.axes[a.targetY]=c}s[a.target]=!0,s[a.targetY]=!0}else{var u=r;a.range===g.Positive?u=Math.max(0,u):a.range===g.Negative&&(u=Math.min(0,u)),a.invert&&(u*=-1),i.axes[a.target]=u,s[a.target]=!0}}else i.axes[n]=r,s[n]=!0;t.axisState[o]=r}}}),this.mapping.axisButtons.forEach(function(t){var e=t.axis,o=t.button,n=t.threshold,r=t.negative;(void 0===n&&(n=M),s[e])&&((r?-i.axes[e]:i.axes[e])>n?i.newState|=o:i.newState&=~o)}),this.mapping.buttonAxes.forEach(function(s){var o=s.button,n=s.axis,r=s.factor;if(!(o>e.buttons.length)){void 0===r&&(r=1);var a=e.buttons[o].value,h=t.buttonValues[o]||0;Math.abs(h-a)>.01&&(i.axes[n]=a*r),t.buttonValues[o]=a}})}}},t}(),st=function(){function t(t,i){var e=this;void 0===t&&(t={}),void 0===i&&(i={}),this.gamepads={},this.gamepadMaps=i;var s=it.isLevel3Supported();this.players=new Array(D),this.keyboards=new Array(D);for(var o=0;o<D;++o){var n=new tt(o);this.players[o]=n;var r=t[o]||A(0,s);this.keyboards[o]=new it(r,n)}var a=navigator.getGamepads();for(o=0;o<a.length;++o){var h=a[o];h&&this.plugGamepad(h)}window.addEventListener("gamepadconnected",function(t){var i=t.gamepad;e.plugGamepad(i)},!1),window.addEventListener("gamepaddisconnected",function(t){var i=t.gamepad;e.unplugGamepad(i)})}return t.prototype.getFor=function(t){return this.players[t]},t.prototype.update=function(){for(var t=0;t<4;++t){var i=this.gamepads[t];i&&i.update()}this.players.forEach(function(t){t.update()})},t.prototype.plugGamepad=function(t,i){var e=t.index,s=this.getGamepadMap(t);if(!i&&s.players){var o=s.players[e];void 0!==o&&(i=this.players[o])}var n=new et(t,s,i);this.gamepads[e]=n},t.prototype.unplugGamepad=function(t){var i=t.index,e=this.gamepads[i];e&&(e.destroy(),delete this.gamepads[i])},t.prototype.getGamepadMap=function(t){var i=this.gamepadMaps[t.id];return void 0===i&&(i=function(t){var i,e,s,o={buttons:(i={},i[0]=T.Rotate,i[1]=T.Rotate,i[2]=T.Drop,i[3]=T.Drop,i[8]=T.Pause,i[9]=T.Pause,i[12]=T.Up,i[13]=T.Down,i[14]=T.Left,i[15]=T.Right,i),axes:(e={},e[0]=R.LeftX,e[1]=R.LeftY,e),axisButtons:[{axis:R.LeftX,button:T.Left,negative:!0,threshold:M},{axis:R.LeftX,button:T.Right,threshold:M},{axis:R.LeftY,button:T.Up,negative:!0,threshold:M},{axis:R.LeftY,button:T.Down,threshold:M}],buttonAxes:[],players:(s={},s[0]=0,s[1]=0,s[2]=0,s[3]=0,s)},n=!1;return t.axes.forEach(function(t,i){(t>1||t<-1)&&(n=!0,o.axes[i]={target:R.DpadX,targetY:R.DpadY,range:g.Hat})}),n&&(o.axisButtons=o.axisButtons.concat([{axis:R.DpadX,button:T.Left,negative:!0,threshold:M},{axis:R.DpadX,button:T.Right,threshold:M},{axis:R.DpadY,button:T.Up,negative:!0,threshold:M},{axis:R.DpadY,button:T.Down,threshold:M}])),o}(t),this.gamepadMaps[t.id]=i),i},t}(),ot=e("HlzF"),nt=["keydown","mousedown","click","touchstart","touchend","pointerdown","pointerup"],rt=function(){function t(){var t=this;this.sfxEnabled=!0,this.sounds={},this.soundBlobs={},this.blobsSetupDone=!1,this.userGestureEvent=this.userGestureEvent.bind(this),window.addEventListener("focus",function(){t.userGestureEvent(),ot.Howler.mute(!1)},!1),window.addEventListener("blur",function(){ot.Howler.mute(!0)},!1)}return t.prototype.userGestureEvent=function(){var t=this;this.blobsSetupDone||(Object.entries(this.soundBlobs).forEach(function(i){var e=i[0],s=i[1];t.sounds[e]=new ot.Howl(s)}),this.blobsSetupDone=!0,nt.forEach(function(i){window.removeEventListener(i,t.userGestureEvent)}))},t.prototype.setSoundBlobs=function(t){var i=this;this.soundBlobs=t,this.blobsSetupDone=!1,nt.forEach(function(t){window.addEventListener(t,i.userGestureEvent,!1)})},t.prototype.setMusic=function(t,i){this.bgm&&this.bgm.unload(),this.bgmFast&&this.bgmFast.unload(),this.bgm=new ot.Howl({src:[t],loop:!0,volume:.5,html5:!0}),this.bgmFast=t===i?this.bgm:new ot.Howl({src:[i],loop:!0,volume:.5,html5:!0})},t.prototype.removeMusic=function(){this.stopMusic(),this.bgm=void 0,this.bgmFast=void 0},t.prototype.playSlowMusic=function(){this.bgm&&this.bgm.play()},t.prototype.playFastMusic=function(){this.bgmFast&&this.bgmFast.play()},t.prototype.stopMusic=function(){this.bgm&&this.bgm.stop(),this.bgmFast&&this.bgmFast.stop()},t.prototype.setSfxEnabled=function(t){this.sfxEnabled=t},t.prototype.isSfxEnabled=function(){return this.sfxEnabled},t.prototype.playSfx=function(t,i){void 0===i&&(i="sfxSprites"),this.sfxEnabled&&this.sounds[i].play(t)},t.prototype.isMusicPlaying=function(){return!(!this.bgm||!this.bgm.playing())||!(!this.bgmFast||!this.bgmFast.playing())},t}(),at=function(){function t(t){this.lastTimestamp=0,this.stage=new n.b,this.sceneManager=new r(this),this.input=new st,this.sound=new rt,this.container=t,n.m.skipHello(),this.view=document.createElement("canvas"),this.view.width=this.container.clientWidth,this.view.height=this.container.clientHeight,this.container.appendChild(this.view),this.ticker=n.k.shared,this.ticker.autoStart=!1,this.ticker.stop();var i={view:this.view};this.renderer=n.l(i)}return t.prototype.run=function(){this.sceneManager.switchTo(new $(this)),this.onResize(),window.addEventListener("resize",this.onResize.bind(this),!1),this.lastTimestamp=window.performance.now(),this.update(this.lastTimestamp);var t=document.getElementById("splash");t&&document.body.removeChild(t)},t.prototype.onResize=function(){var t=this.container.clientWidth,i=this.container.clientHeight;this.view.width=t,this.view.height=i,this.renderer.resize(t,i),this.sceneManager.updateScreenSize(t,i)},t.prototype.update=function(t){var i=(t-this.lastTimestamp)/1e3;this.lastTimestamp=t,this.input.update(),this.sceneManager.update(i)&&this.renderer.render(this.stage),requestAnimationFrame(this.update.bind(this))},t.prototype.getSize=function(){return{width:this.renderer.width,height:this.renderer.height}},t}();i.default=at},cmuR:function(t,i,e){t.exports=e.p+"assets/2uDDmKv.mp3"},iUa2:function(t,i,e){t.exports=e.p+"assets/_MkCAEx.mp3"},"jk+9":function(t,i,e){t.exports=e.p+"assets/1YvKpoR.mp3"},"rtd/":function(t,i,e){t.exports=e.p+"assets/13ze2pS.mp3"}}]);